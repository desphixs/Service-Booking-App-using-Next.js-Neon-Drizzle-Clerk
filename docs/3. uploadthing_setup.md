For December 2025, the industry standard for handling image uploads in Next.js is **UploadThing**. It is a modern, developer-friendly alternative to S3 that handles the complex parts of file management while remaining deeply integrated with Next.js App Router and Server Actions.

### Why UploadThing?

-   **Best Free Tier:** Offers **2GB of storage** for free with unlimited uploads/downloads.
-   **Modern Developer Experience:** You get ready-to-use React components (Buttons, Dropzones) and hooks like `useUploadThing`.
-   **Security Built-in:** Authentication happens on your server via middleware, but the heavy lifting of the upload happens on theirs.

---

### Step 1: UploadThing Initial Setup

1. **Create an Account:** Visit [uploadthing.com](https://uploadthing.com/) and create a new application.
2. **API Keys:** Grab your `UPLOADTHING_SECRET` and `UPLOADTHING_APP_ID` from the dashboard.
3. **Environment Variables:** Add them to your `.env.local`:

```env
UPLOADTHING_SECRET=sk_live_...
UPLOADTHING_APP_ID=...

```

4. **Install Packages**:

```bash
npm install uploadthing @uploadthing/react

```

---

### Step 2: Configure the File Router

This defines _where_ and _how_ files are uploaded on your server.

**File:** `app/api/uploadthing/core.ts`

```typescript
import { createUploadthing, type FileRouter } from "uploadthing/next";
import { auth } from "@clerk/nextjs/server"; // Or your auth provider

const f = createUploadthing();

export const ourFileRouter = {
    // Define an "imageUploader" endpoint
    imageUploader: f({ image: { maxFileSize: "4MB", maxFileCount: 1 } })
        .middleware(async () => {
            const { userId } = await auth(); // Verify user is logged in
            if (!userId) throw new Error("Unauthorized");
            return { userId };
        })
        .onUploadComplete(async ({ metadata, file }) => {
            console.log("Upload complete for userId:", metadata.userId);
            console.log("File URL:", file.url); // This is the URL we save to the DB
            return { uploadedBy: metadata.userId };
        }),
} satisfies FileRouter;

export type OurFileRouter = typeof ourFileRouter;
```

---

### Step 3: Create the API Route and Components

You must expose the router via an API route and generate the typesafe components.

**API Route:** `app/api/uploadthing/route.ts`

```typescript
import { createRouteHandler } from "uploadthing/next";
import { ourFileRouter } from "./core";

export const { GET, POST } = createRouteHandler({
    router: ourFileRouter,
});
```

**UI Utils:** `utils/uploadthing.ts`

```typescript
import { generateUploadButton, generateUploadDropzone } from "@uploadthing/react";
import type { OurFileRouter } from "@/app/api/uploadthing/core";

export const UploadButton = generateUploadButton<OurFileRouter>();
export const UploadDropzone = generateUploadDropzone<OurFileRouter>();
```

---

### Step 4: The Next.js Server Action (Drizzle)

Create a Server Action to save the service data, including the new image URL, to your database.

**File:** `app/actions/services.ts`

```typescript
"use server";
import { db } from "@/db";
import { services } from "@/db/schema";
import { revalidatePath } from "next/cache";
import { redirect } from "next/navigation"; //

export async function createServiceAction(formData: FormData, imageUrl: string) {
    // Manual extraction or use Zod for validation
    const title = formData.get("title") as string;
    const description = formData.get("description") as string;
    const price = parseInt(formData.get("price") as string);
    const userId = formData.get("userId") as string; // Pass from Clerk

    const slug = title.toLowerCase().replace(/ /g, "-");

    await db.insert(services).values({
        userId,
        title,
        slug,
        description,
        image: imageUrl, // Saved from UploadThing
        price,
        category: formData.get("category") as string,
        // Add other fields as necessary
    });

    revalidatePath("/dashboard/services"); // Revalidate cache
    redirect("/dashboard/services"); // Redirect user
}
```

---

### Step 5: The Admin Dashboard Form

This client component manages the local state for the image URL and handles the form submission.

**File:** `components/admin/CreateServiceForm.tsx`

```tsx
"use client";
import { useState } from "react";
import { UploadButton } from "@/utils/uploadthing";
import { createServiceAction } from "@/app/actions/services";

export default function CreateServiceForm({ userId }: { userId: string }) {
    const [imageUrl, setImageUrl] = useState<string>("");

    const handleSubmit = async (formData: FormData) => {
        if (!imageUrl) return alert("Please upload an image first!");
        await createServiceAction(formData, imageUrl);
    };

    return (
        <form action={handleSubmit} className="space-y-4 max-w-xl">
            <input type="hidden" name="userId" value={userId} />

            <div>
                <label className="block text-sm font-bold mb-1">Service Image</label>
                {imageUrl ? <img src={imageUrl} className="w-40 h-40 object-cover rounded-lg mb-2" /> : <UploadButton endpoint="imageUploader" onClientUploadComplete={(res) => setImageUrl(res[0].url)} onUploadError={(error) => alert(`ERROR! ${error.message}`)} />}
            </div>

            <input name="title" placeholder="Service Title" required className="w-full border p-2 rounded" />
            <textarea name="description" placeholder="Description" className="w-full border p-2 rounded" />
            <input name="price" type="number" placeholder="Price in Cents" required className="w-full border p-2 rounded" />

            <button type="submit" className="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold">
                Create Service
            </button>
        </form>
    );
}
```

This guide covers a complete image hosting setup for a Next.js 15 application.
